/* ========================================
   SISTEMA DE TRADU√á√ÉO (PT / EN / ES)
======================================== */

const currentYear = new Date().getFullYear();

const translations = {
  // --- PORTUGU√äS (Padr√£o) ---
  'pt': {
    'hero_title': '<span class="highlight">Comunicar, aprender</span> e se<br><span class="highlight">divertir</span> ‚Äî tudo em um <br>aplicativo seguro!',
    'hero_desc': 'Porque crian√ßa merece se comunicar com alegria ‚Äî e n√≥s estamos aqui para tornar essa experi√™ncia √∫nica',
    'btn_download': 'Em Breve Dispon√≠vel',
    
    'section_why': 'Por que Autikids?',
    'feature_1_title': 'Totalmente personaliz√°vel',
    'feature_1_desc': 'O app se molda ao ritmo, interesses e necessidades de cada pequeno.',
    'feature_2_title': 'Ambiente Seguro',
    'feature_2_desc': 'Aqui prezamos pela experi√™ncia segura da crian√ßa. Por isso, nosso app √© 100% livre de an√∫ncios para os pequenos.',
    'feature_3_title': 'Facilita a comunica√ß√£o',
    'feature_3_desc': 'Recursos de √°udio e cards intuitivos para uma comunica√ß√£o sem barreiras.',
    'feature_4_title': 'Parceria entre casa e escola',
    'feature_4_desc': 'Conecta pais e educadores para alinhar o desenvolvimento da crian√ßa.',



    '_badge': 'O Autikids est√° chegando!',
    'pricing_title': 'Nossos personagens s√£o desenhados para serem amig√°veis e acolhedores, criando uma experi√™ncia inclusiva para todas as crian√ßas',

    

    'section_media': '#Autikids na m√≠dia',
    'media_1': 'Destaque em Evento',
    'media_2': 'Reconhecimento Cient√≠fico',
    'media_3': 'Projeto Premiado',

    'section_testi': 'Veja como o Autikids est√° fazendo a diferen√ßa üíõ',
    'testi_1': '"O app nos ajudou a estabelecer uma rotina educacional em casa. Meu filho melhorou muito."',
    'testi_2': '"Muitas atividades com refor√ßo positivo ‚Äî crian√ßas adoram."',
    'testi_3': '"Ferramenta excelente para professores e familiares."',
    'testi_4': '"Minha filha est√° se comunicando melhor a cada dia. Muito obrigada!"',
    'testi_5': '"Interface intuitiva e cheia de recursos √∫teis para o dia a dia."',
    'testi_6': '"Recomendo para todas as fam√≠lias. Mudou nossa vida!"',
    'testi_7': '"Trabalho com autismo h√° 10 anos e esse √© o melhor app que j√° vi."',
    'testi_8': '"As atividades s√£o muito bem pensadas e educativas."',
    'testi_9': '"Meu neto adora usar o app todos os dias!"',
    
    'footer_help': 'Central de Ajuda',
    'footer_terms': 'Termos de Uso',
    'footer_privacy': 'Pol√≠tica de Privacidade',
    'footer_cookies': 'Pol√≠tica de Cookies',
    'footer_social': 'Nossas redes sociais:',
    'footer_rights': `¬© ${currentYear} Autikids | Todos os direitos reservados`
  },

  // --- INGL√äS ---
  'en': {
    'hero_title': '<span class="highlight">Communicate, learn</span> and have<br><span class="highlight">fun</span> ‚Äî all in one <br>safe app!',
    'hero_desc': 'Because every child deserves to communicate with joy ‚Äî and we are here to make this experience unique.',
    'btn_download': 'Coming Soon',
    
    'section_why': 'Why Autikids?',
    'feature_1_title': 'Fully Customizable',
    'feature_1_desc': 'The app adapts to the rhythm, interests, and needs of each little one.',
    'feature_2_title': 'Safe Environment',
    'feature_2_desc': 'We value the safe experience of children. That\'s why our app is 100% ad-free for kids.',
    'feature_3_title': 'Facilitates Communication',
    'feature_3_desc': 'Audio resources and intuitive cards for barrier-free communication.',
    'feature_4_title': 'Home & School Partnership',
    'feature_4_desc': 'Connects parents and educators to align the child\'s development.',
    


    'section_media': '#Autikids in the Media',
    'media_1': 'Event Highlight',
    'media_2': 'Scientific Recognition',
    'media_3': 'Awarded Project',

    '_badge': ' Autikids is coming!',
    'pricing_title': 'Our characters are designed to be friendly and welcoming, creating an inclusive experience for all children',
    


    'section_testi': 'See how Autikids is making a difference üíõ',
    'testi_1': '"The app helped us establish an educational routine at home. My son has improved a lot."',
    'testi_2': '"Lots of positive reinforcement activities ‚Äî kids love it."',
    'testi_3': '"Excellent tool for teachers and family members."',
    'testi_4': '"My daughter is communicating better every day. Thank you so much!"',
    'testi_5': '"Intuitive interface full of useful features for everyday life."',
    'testi_6': '"I recommend it to all families. It changed our lives!"',
    'testi_7': '"I\'ve been working with autism for 10 years and this is the best app I\'ve ever seen."',
    'testi_8': '"The activities are very well thought out and educational."',
    'testi_9': '"My grandson loves using the app every day!"',
    
    'footer_help': 'Help Center',
    'footer_terms': 'Terms of Use',
    'footer_privacy': 'Privacy Policy',
    'footer_cookies': 'Cookie Policy',
    'footer_social': 'Our social networks:',
    'footer_rights': `¬© ${currentYear} Autikids | All rights reserved`
  },

  // --- ESPANHOL ---
  'es': {
    'hero_title': '<span class="highlight">Comunicar, aprender</span> y <br><span class="highlight">divertirse</span> ‚Äî ¬°todo en una <br>aplicaci√≥n segura!',
    'hero_desc': 'Porque los ni√±os merecen comunicarse con alegr√≠a ‚Äî y estamos aqu√≠ para hacer de esta experiencia algo √∫nico.',
    'btn_download': 'Pr√≥ximamente Disponible',
    
    'section_why': '¬øPor qu√© Autikids?',
    'feature_1_title': 'Totalmente personalizable',
    'feature_1_desc': 'La aplicaci√≥n se adapta al ritmo, intereses y necesidades de cada peque√±o.',
    'feature_2_title': 'Entorno Seguro',
    'feature_2_desc': 'Aqu√≠ valoramos la experiencia segura del ni√±o. Por eso, nuestra app es 100% libre de anuncios para los peque√±os.',
    'feature_3_title': 'Facilita la comunicaci√≥n',
    'feature_3_desc': 'Recursos de audio y tarjetas intuitivas para una comunicaci√≥n sin barreras.',
    'feature_4_title': 'Alianza casa y escuela',
    'feature_4_desc': 'Conecta a padres y educadores para alinear el desarrollo del ni√±o.',

    

    'section_media': '#Autikids en los medios',
    'media_1': 'Destacado en Evento',
    'media_2': 'Reconocimiento Cient√≠fico',
    'media_3': 'Proyecto Premiado',

    '_badge': ' Autikids llegar√° pronto!',
    'pricing_title': 'Nuestros personajes est√°n dise√±ados para ser amigables y acogedores, creando una experiencia inclusiva para todos los ni√±os',

    'section_testi': 'Mira c√≥mo Autikids est√° haciendo la diferencia üíõ',
    'testi_1': '"La app nos ayud√≥ a establecer una rutina educativa en casa. Mi hijo mejor√≥ mucho."',
    'testi_2': '"Muchas actividades con refuerzo positivo ‚Äî a los ni√±os les encanta."',
    'testi_3': '"Herramienta excelente para profesores y familiares."',
    'testi_4': '"¬°Mi hija se est√° comunicando mejor cada d√≠a. Muchas gracias!"',
    'testi_5': '"Interfaz intuitiva y llena de recursos √∫tiles para el d√≠a a d√≠a."',
    'testi_6': '"Lo recomiendo a todas las familias. ¬°Cambi√≥ nuestras vidas!"',
    'testi_7': '"Trabajo con autismo desde hace 10 a√±os y esta es la mejor app que he visto."',
    'testi_8': '"Las actividades est√°n muy bien pensadas y son educativas."',
    'testi_9': '"¬°A mi nieto le encanta usar la app todos los d√≠as!"',
    
    'footer_help': 'Centro de Ayuda',
    'footer_terms': 'T√©rminos de Uso',
    'footer_privacy': 'Pol√≠tica de Privacidad',
    'footer_cookies': 'Pol√≠tica de Cookies',
    'footer_social': 'Nuestras redes sociales:',
    'footer_rights': `¬© ${currentYear} Autikids | Todos los derechos reservados`
  }
};


// Lista de chaves que precisam suportar HTML (whitelist)
const KEYS_WITH_HTML = ['hero_title'];

// Classes CSS permitidas em elementos HTML sanitizados
const ALLOWED_SPAN_CLASS = 'highlight';

// Fun√ß√£o para sanitizar HTML permitindo apenas tags seguras
function sanitizeHTML(html) {
  try {
    // Usa DOMParser para parsing mais seguro
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');
    
    // Verifica se o parsing foi bem-sucedido
    if (!doc || !doc.body) {
      // Fallback: retorna apenas o conte√∫do de texto
      const temp = document.createElement('div');
      temp.textContent = html;
      return temp.textContent;
    }
    
    // Fun√ß√£o recursiva para validar e limpar elementos
    function sanitizeNode(node) {
      // Se for um n√≥ de texto, retornar o texto
      if (node.nodeType === Node.TEXT_NODE) {
        return document.createTextNode(node.textContent);
      }
      
      // Se for um elemento, validar tag e atributos
      if (node.nodeType === Node.ELEMENT_NODE) {
        const tagName = node.tagName.toLowerCase();
        
        // Apenas permitir span e br
        if (tagName === 'span') {
          // Validar que span tem APENAS um atributo e que √© class="highlight"
          const hasOnlyClassAttribute = node.attributes.length === 1;
          const hasCorrectClass = node.getAttribute('class') === ALLOWED_SPAN_CLASS;
          
          if (hasOnlyClassAttribute && hasCorrectClass) {
            const newSpan = document.createElement('span');
            newSpan.className = ALLOWED_SPAN_CLASS;
            // Processar filhos recursivamente
            Array.from(node.childNodes).forEach(child => {
              const sanitizedChild = sanitizeNode(child);
              if (sanitizedChild) {
                newSpan.appendChild(sanitizedChild);
              }
            });
            return newSpan;
          }
          // Se span n√£o tem atributos corretos, retornar apenas o conte√∫do de texto
          return document.createTextNode(node.textContent);
        } else if (tagName === 'br') {
          // br n√£o deve ter nenhum atributo
          if (node.attributes.length === 0) {
            return document.createElement('br');
          }
          // Se br tem atributos, retornar como texto para consist√™ncia
          return document.createTextNode(node.textContent);
        }
        
        // Qualquer outra tag: retornar apenas texto
        return document.createTextNode(node.textContent);
      }
      
      // Qualquer outro tipo de n√≥: ignorar
      return null;
    }
    
    // Criar container para o resultado sanitizado
    const result = document.createElement('div');
    Array.from(doc.body.childNodes).forEach(child => {
      const sanitizedChild = sanitizeNode(child);
      if (sanitizedChild) {
        result.appendChild(sanitizedChild);
      }
    });
    
    return result.innerHTML;
  } catch (error) {
    // Em caso de erro, retornar apenas o conte√∫do de texto (fallback seguro)
    console.error('Erro ao sanitizar HTML:', error);
    const temp = document.createElement('div');
    temp.textContent = html;
    return temp.textContent;
  }
}

// Fun√ß√£o para trocar o idioma
function changeLanguage(lang) {
  // 1. Salva a prefer√™ncia do usu√°rio no navegador
  localStorage.setItem('autikids-language', lang);

  // 2. Atualiza os textos na p√°gina
  const elements = document.querySelectorAll('[data-i18n]');
  
  elements.forEach(element => {
    const key = element.getAttribute('data-i18n');
    
    // Verifica se existe tradu√ß√£o para essa chave
    if (translations[lang] && translations[lang][key]) {
      // Usa textContent por padr√£o (seguro contra XSS)
      // Apenas chaves espec√≠ficas na whitelist podem usar HTML sanitizado
      if (KEYS_WITH_HTML.includes(key)) {
        element.innerHTML = sanitizeHTML(translations[lang][key]);
      } else {
        element.textContent = translations[lang][key];
      }
    }
  });
}

// Ao carregar a p√°gina, verifica se j√° tem idioma salvo
document.addEventListener('DOMContentLoaded', () => {
  const savedLang = localStorage.getItem('autikids-language') || 'pt'; // Padr√£o PT
  changeLanguage(savedLang);
});